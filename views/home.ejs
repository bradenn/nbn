<!DOCTYPE html>
<html lang="en" <% if(user != null){ %>data-theme="<%= user.theme %>" <% }else{ %> data-theme="dark" <% } %>>
<%- include("partials/header.ejs"); %>

<body>
  <%- include("partials/nav.ejs"); %>
  <div class="container" style="margin-top:32px;">
    <div class="row">
      <div class="col-md-12">
        <div class="row">
          <div class="col-md-2">
            <a href="/new" class="btn btn-primary side-col">New Topic</a>
            <hr>
            <ul class="list-group">
              <li class="list-group-item active"><i class="fas fa-stream drawer-icon"></i><a href="#" class="drawer-link">All Discussion</a></li>
              <li class="list-group-item"><i class="fas fa-list drawer-icon"></i><a href="#" class="drawer-link">Following</a></li>
              <li class="list-group-item"><i class="fas fa-tags drawer-icon"></i><a href="#" class="drawer-link">Tags</a></li>
            </ul>
          </div>
          <div class="col-md-10">
            <div class="btn-group float-right">
              <button type="button" class="btn btn-outline-light dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Latest
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="#">Latest</a>
                <a class="dropdown-item" href="#">Hot</a>
                <a class="dropdown-item" href="#">Date</a>
              </div>
            </div>
            <% topics.forEach(function(topic){ %>
            <a href="/topic/<%= topic._id %>" class="no-bs">
              <div class="topic-inline">
                <div class="topic-inline-element margin-right">
                  <img src="<%= topic.owner.picture %>" class="topic-inline-image">
                </div>
                <div class="topic-inline-element">
                  <span class="topic-inline-title"><%= topic.title %></span>
                  <span class="topic-inline-subtext">Last updated <strong><%= timeSince(new Date(topic.date)) %> ago</strong></span>
                </div>
                <div class="topic-inline-preview">
                  <span class="topic-inline-preview-text"><%= topic.body %></span>
                </div>
              </div>
            </a>
            <% }); %>
          </div>
        </div>
      </div>
    </div>
</body>

</html>
<%

function timeSince(date) {

  var seconds = Math.floor((new Date() - date) / 1000);

  var interval = Math.floor(seconds / 31536000);

  if (interval > 1) {
    return interval + " years";
  }
  interval = Math.floor(seconds / 2592000);
  if (interval > 1) {
    return interval + " months";
  }
  interval = Math.floor(seconds / 86400);
  if (interval > 1) {
    return interval + " days";
  }
  interval = Math.floor(seconds / 3600);
  if (interval > 1) {
    return interval + " hours";
  }
  interval = Math.floor(seconds / 60);
  if (interval > 1) {
    return interval + " minutes";
  }
  return Math.floor(seconds) + " seconds";
}
var aDay = 24*60*60*1000
%>
