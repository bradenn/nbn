<!DOCTYPE html>
<html lang="en" <% if(user != null){ %>data-theme="<%= user.theme %>"
<% }else{ %> data-theme="dark"
        <% } %>
>
<%- include("partials/header.ejs"); %>

<body>
<%- include("partials/nav.ejs"); %>
<div class="container" style="margin-top:32px;">
    <div class="row">
        <div class="col-md-3">
        </div>
        <div class="col-md-6">
            <form action="/search/" method="get">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" name="q" id="q" placeholder="Search Query"
                           value="<%= query %>">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="submit">Search</button>
                    </div>
                </div>
            </form>
            <div class="search-header">
                <span class="text-dark text-xl">Search results:</span>
                <% if(topics.length != 0 || users != null){ %>
                    <span class="text-muted text-sm">Query returned <%= topics.length + users.length %> item(s) in <%= time %> seconds.</span>
                <% } %>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <% if(users != null){ %>
                        <span class="text-dark text-xl">Users:</span>
                        <% users.forEach(function(usr){ %>
                            <a href="/u/<%= usr.username %>" class="no-bs">
                                <div class="topic-inline">
                                    <div class="topic-inline-element margin-right">
                                        <img src="<%= usr.picture %>" class="topic-inline-image">
                                    </div>
                                    <div class="topic-inline-element">
                                        <span class="topic-inline-title"><%= usr.username %></span>
                                    </div>
                                </div>
                            </a>

                    <% }); } if(users.length == 0){ %>
                        <span class="text-muted">No results found for "<i><%= query %></i>"</span>
                    <% } %>
                </div>
            </div>

            <% if(topics != null){ %>
                <br>
                <span class="text-dark text-xl">Articles:</span>
            <div class="row">
                <% topics.forEach((topic) => { %>
                    <div class="col-md-12">
                        <a href="/topic/<%= topic._id %>" class="no-bs">
                            <div class="card mb-3 card-bg"
                                 style="background-image: linear-gradient(to bottom, rgba(0, 0, 0, .0), rgba(0, 0, 0, .7)), url(<%= topic.picture %>)">
                                <div class="row no-gutters">
                                    <div class="col-md-8">
                                        <div class="title-container">
                                            <div class="title-box">
                                                <h5><%= titles(topic.title) %></h5>
                                                <span class="tiny-info"><%= topic.views %> Views â€¢ <%= timeSince(new Date(topic.date)) %> ago</span>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>

                <% }); } if(topics.length == 0){ %>
                    <div class="col-md-12">
                        <span class="text-muted">No results found for "<i><%= query %></i>"</span>
                    </div>
                <% } %>
            </div>
        </div>
        <br>
    </div>
</div>
</body>

</html>
<%
function timeSince(date) {

    var seconds = Math.floor((new Date() - date) / 1000);

    var interval = Math.floor(seconds / 31536000);

    if (interval > 1) {
        return interval + " years";
    }
    interval = Math.floor(seconds / 2592000);
    if (interval > 1) {
        return interval + " months";
    }
    interval = Math.floor(seconds / 86400);
    if (interval > 1) {
        return interval + " days";
    }
    interval = Math.floor(seconds / 3600);
    if (interval > 1) {
        return interval + " hours";
    }
    interval = Math.floor(seconds / 60);
    if (interval > 1) {
        return interval + " minutes";
    }
    return Math.floor(seconds) + " seconds";
}
var aDay = 24 * 60 * 60 * 1000

function titles(title) {
    let t = title.substring(0, 50);
    if (t.length >= 49) t += "...";
    return t;
}
%>
