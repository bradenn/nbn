<!DOCTYPE html>
<html lang="en" <% if(user != null){ %>data-theme="<%= user.theme %>" <% }else{ %> data-theme="dark" <% } %>>
<%- include("partials/header.ejs"); %>

<body>
  <%- include("partials/nav.ejs"); %>
  <div class="container" style="margin-top:32px;">
    <div class="row">
      <div class="col-md-8">
        <div class="topic">
          <div class="topic-element margin-right">
            <img src="<%= topic.owner.picture %>" class="topic-image">
          </div>
          <div class="topic-element">
            <span class="topic-title"><%= topic.title %></span>
            <span class="topic-subtext">posted by <strong><a href="/u/<%= topic.owner.username %>" class="no-bs"><%= topic.owner.username %></a></strong></span>
          </div>
          <div class="topic-element float-right">
            <span class="topic-subtext">Last updated <strong><%= timeSince(new Date(topic.date)) %> ago</strong></span>
          </div>
          <div class="topic-preview">
            <span class="topic-preview-text"><%- topic.body %></span>
          </div>
          <div class="topic-comments">
            <h5>Comments (<%= comments.length %>)</h5>
            <form action="/topic/<%= topic._id %>/comment" method="post">
              <div class="input-group mb-3">
                <input type="text" name="text" class="form-control form-msg" placeholder="Comment">
                <div class="input-group-append">
                  <button class="btn btn-primary" type="submit">Send</button>
                </div>
              </div>
            </form>
            <ul>
              <% comments.forEach(function(comment){ %>
              <li class="comment">
                <div class="comment-inline">
                  <span class="title"><a href="/u/<%= comment.user.username %>" class="no-bs"><%= comment.user.username %></a></span>
                </div>
                <span class="sub-title">posted <strong><%= timeSince(new Date(comment.date)) %></strong> ago</span>
                <p><%= comment.text %></p>
              </li>
              <% }); %>
              <% if(comments.length <= 0){ %>
              <li class="comment">
                <span class="title">No comments</span>
              </li>
              <% } %>
            </ul>
          </div>
        </div>
      </div>
    </div>
</body>

</html>

<%

function timeSince(date) {

  var seconds = Math.floor((new Date() - date) / 1000);

  var interval = Math.floor(seconds / 31536000);

  if (interval >= 1) {
    return interval + " years";
  }
  interval = Math.floor(seconds / 2592000);
  if (interval >= 1) {
    return interval + " months";
  }
  interval = Math.floor(seconds / 86400);
  if (interval >= 1) {
    return interval + " days";
  }
  interval = Math.floor(seconds / 3600);
  if (interval >= 1) {
    return interval + " hours";
  }
  interval = Math.floor(seconds / 60);
  if (interval >= 1) {
    return interval + " minutes";
  }
  return Math.floor(seconds) + " seconds";
}
var aDay = 24*60*60*1000
%>
